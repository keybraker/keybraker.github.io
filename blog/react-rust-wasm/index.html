<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.f3b087403fcd4302430d.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.32.13"/><style data-styled="eWXuFb  dZTLiU cxhdwc fkmnfK eJXFLa bSuiGc liQTCq elkVYF dgaDPU fxovqS" data-styled-version="4.4.1">
/* sc-component-id: ZoomImage__StyledFigcaption-sc-1h80lva-0 */
.dgaDPU{text-align:right;font-size:0.8em;padding:0.25em 0;color:#999;}
/* sc-component-id: Nav__StyledNav-sc-10pvdn5-0 */
.eJXFLa{margin-bottom:1em;} @media (min-width:520px){.eJXFLa{margin-bottom:2em;}}
/* sc-component-id: Nav__StyledList-sc-10pvdn5-1 */
.bSuiGc{padding:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-top:0;} @media (min-width:520px){.bSuiGc{display:block;}}
/* sc-component-id: Nav__ListElement-sc-10pvdn5-2 */
.liQTCq{display:inline-block;padding:0.5em;text-align:center;font-size:1.8rem;} @media (min-width:300px){.liQTCq{font-size:2.2rem;padding-right:0;padding-left:0;}} @media (min-width:350px){.liQTCq{font-size:2.2rem;}} @media (min-width:520px){.liQTCq{padding:0;margin-right:2rem;font-size:2.4rem;}} .liQTCq:after{content:' ';display:none;white-space:pre;} @media (min-width:520px){.liQTCq:after{display:inline-block;}}
/* sc-component-id: Nav__NavItem-sc-10pvdn5-3 */
.elkVYF{color:black;border:none;} .elkVYF:hover{color:blue;} .elkVYF:before{content:'/';display:none;} @media (min-width:520px){.elkVYF:before{display:inline;}} .elkVYF.active{font-weight:bold;}
/* sc-component-id: sc-global-2049630349 */
html{line-height:1.15;-webkit-text-size-adjust:100%;} body{margin:0;} main{display:block;} h1{font-size:2em;margin:0.67em 0;} hr{box-sizing:content-box;height:0;overflow:visible;} pre{font-family:monospace,monospace;font-size:1em;} a{background-color:transparent;} abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;} b,strong{font-weight:bolder;} code,kbd,samp{font-family:monospace,monospace;font-size:1em;} small{font-size:80%;} sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;} sub{bottom:-0.25em;} sup{top:-0.5em;} img{border-style:none;} button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;} button,input{overflow:visible;} button,select{text-transform:none;} button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;} button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;} button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;} fieldset{padding:0.35em 0.75em 0.625em;} legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;} progress{vertical-align:baseline;} textarea{overflow:auto;} [type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;} [type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;} [type="search"]{-webkit-appearance:textfield;outline-offset:-2px;} [type="search"]::-webkit-search-decoration{-webkit-appearance:none;} ::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;} details{display:block;} summary{display:list-item;} template{display:none;} [hidden]{display:none;} html,body{height:100%;} html{box-sizing:border-box;font-size:62.5%;} body{font-size:16px;font-size:1.6rem;font-family:'Roboto Mono',monospace;word-break:break-word;} h1,h2,h3,h4,h5,h6{font-family:'Rubik',sans-serif;margin:0.5em 0;} *,*:before,*:after{box-sizing:inherit;} iframe{margin:0 auto;display:block;max-width:100%;width:100%;} iframe.youtube{height:20rem;} @media (min-width:550px){iframe.youtube{height:34rem;}} blockquote{margin-left:1em;margin-right:1em;} @media (min-width:520px){blockquote{margin-left:2em;margin-right:2em;}} figure{margin:0;} ul{padding:0;list-style:square;} a{-webkit-text-decoration:none;text-decoration:none;color:blue;border-bottom:2px solid transparent;} a:hover{color:#999;border-color:#999;} a.anchor{border:none;} p{line-height:1.5em;font-size:1.8rem;} twitterwidget{margin:0 auto;} .sidebar{margin-left:auto;margin-right:auto;} @media (min-width:520px){.sidebar{width:calc(50% + 1em);clear:both;float:right;padding-left:1em;}} .sidebar.left{float:left;padding-left:0;padding-right:1em;} .sidebar img{width:100%;} .blog-full,.blog-inset{margin-left:auto;margin-right:auto;width:100%;} .blog-full img,.blog-inset img{width:100%;} @media (min-width:520px){.blog-inset{margin-top:2em;margin-bottom:2em;width:80%;}} .blog-section{font-size:1.8rem;} .blog-section:not(:first-child){margin-top:2em;} .blog-section h1,.blog-section h2,.blog-section h3,.blog-section h4,.blog-section h5,.blog-section h6{margin-bottom:0.5em;} .blog-section h1 + p,.blog-section h2 + p,.blog-section h3 + p,.blog-section h4 + p,.blog-section h5 + p,.blog-section h6 + p{margin-top:0.5em;} .blog-section ul{margin-left:1.5em;} @media (min-width:520px){.blog-section ul{margin-left:2.5em;}} .blog-section li{margin:0.5em 0;line-height:1.5em;} .blog-section li p{margin:0;} :not(pre) > code[class*="language-"],pre[class*="language-"]{font-size:0.9em;} .gatsby-highlight-code-line{background-color:#feb;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:0.75em;border-left:0.25em solid #f99;} @media (min-width:520px){.gatsby-resp-image-wrapper{margin-top:2em;margin-bottom:2em;width:80%;}}
/* sc-component-id: Layout__Main-p46nka-0 */
.eWXuFb{max-width:83rem;padding:1em 1em 2em;margin:0 auto;} @media (min-width:350px){.eWXuFb{padding:1em 1.5em 4em;}} @media (min-width:520px){.eWXuFb{padding:2rem 2em 6rem;}}
/* sc-component-id: Layout__StyledTitle-p46nka-2 */
.cxhdwc{margin:0.3em 0;} @media (min-width:350px){.cxhdwc{margin:0.5em 0 0.2em;}} @media (min-width:520px){.cxhdwc{margin:0.667em 0;}}
/* sc-component-id: Layout__TitleLink-p46nka-3 */
.fkmnfK{text-transform:lowercase;color:#000;-webkit-text-decoration:none;text-decoration:none;border:none;} .fkmnfK:hover{color:#0000ff;}
/* sc-component-id: post__StyledPostDate-sd6zd6-0 */
.fxovqS{color:#999;font-weight:400;display:block;margin-top:1em;margin-bottom:1em;text-align:right;}</style><title data-react-helmet="true">Ioannis Tsiakkas | Up and Running with React + Rust + Wasm</title><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link data-react-helmet="true" rel="shortcut icon" type="image/x-icon" href="/favicon.ico"/><link data-react-helmet="true" rel="manifest" href="/manifest.json"/><link data-react-helmet="true" rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,700|Rubik:700" rel="stylesheet"/><meta data-react-helmet="true" name="theme-color" content="#ffffff"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url" content="https://prestonrichey.com"/><meta data-react-helmet="true" property="og:image" content="https://prestonrichey.com/social-meta.png"/><meta data-react-helmet="true" property="og:image:secure_url" content="https://prestonrichey.com/social-meta.png"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:image" content="https://prestonrichey.com/social-meta.png"/><meta data-react-helmet="true" name="twitter:creator" content="@prestonrichey"/><meta data-react-helmet="true" property="og:title" content="Up and Running with React + Rust + Wasm"/><meta data-react-helmet="true" name="twitter:title" content="Up and Running with React + Rust + Wasm"/><meta data-react-helmet="true" property="og:description" content="A very roundabout way to call window.alert()."/><meta data-react-helmet="true" name="twitter:description" content="A very roundabout way to call window.alert()."/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-f494e936f949e325e958.js"/><link as="script" rel="preload" href="/framework-eb684e3e828ad13b3940.js"/><link as="script" rel="preload" href="/app-51712915004c1ee7906c.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/b4c8b9bfe57989d347dcb0518f327ec77d315bf1-81e54c09b1119b78609f.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-3a720babd166f93a18ee.js"/><link as="fetch" rel="preload" href="/page-data/blog/react-rust-wasm/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><main class="Layout__Main-p46nka-0 eWXuFb"><header class="Layout__StyledHeader-p46nka-1 dZTLiU"><h1 class="Layout__StyledTitle-p46nka-2 cxhdwc"><a class="Layout__TitleLink-p46nka-3 fkmnfK" href="/">Ioannis Tsiakkas</a></h1><nav class="Nav__StyledNav-sc-10pvdn5-0 eJXFLa"><ul class="Nav__StyledList-sc-10pvdn5-1 bSuiGc"><li class="Nav__ListElement-sc-10pvdn5-2 liQTCq"><a class="Nav__NavItem-sc-10pvdn5-3 elkVYF" href="/about/">about me</a></li><li class="Nav__ListElement-sc-10pvdn5-2 liQTCq"><a class="Nav__NavItem-sc-10pvdn5-3 elkVYF" href="/projects/">projects</a></li><li class="Nav__ListElement-sc-10pvdn5-2 liQTCq"><a class="Nav__NavItem-sc-10pvdn5-3 elkVYF" href="/experience/">experience</a></li><li class="Nav__ListElement-sc-10pvdn5-2 liQTCq"><a class="Nav__NavItem-sc-10pvdn5-3 elkVYF" href="/education/">education</a></li></ul></nav></header><h1>Up and Running with React + Rust + Wasm</h1><section class="blog-section"><p>I’m super excited about <a target="_blank" rel="noopener noreferrer" href="https://webassembly.org/">WebAssembly</a>! It’s fast, (can be) small, and extremely portable. In fact, I wouldn’t be surprised if in the near future most web developers write code that eventually gets compiled to Wasm.</p><p>But currently there’s not a huge selection of resources showing how to get started with WebAssembly, and I couldn’t find any tutorials that worked with <a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/create-react-app">create-react-app</a>. Most focus on writing and compiling a module, but rush over the details of actually using Wasm code. What follows is a basic setup for a React app using WebAssembly that should serve as a good foundation for more complex applications.</p></section><section class="blog-section"><h2 id="setup" style="position:relative"><a href="#setup" aria-label="setup permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup</h2><p>This post assumes basic familiarity with the command line, React, and the basics of Rust tooling. If you get stuck, the <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/book/">Rust Book</a> and <a target="_blank" rel="noopener noreferrer" href="https://reactjs.org/tutorial/tutorial.html">Intro to React</a> are great resources.</p><p>First, go through the setup docs <a target="_blank" rel="noopener noreferrer" href="https://rustwasm.github.io/book/game-of-life/setup.html">here</a> in the very helpful <a target="_blank" rel="noopener noreferrer" href="https://rustwasm.github.io/book/">Rust Wasm</a> book. Install the <a target="_blank" rel="noopener noreferrer" href="https://www.rust-lang.org/tools/install">Rust toolchain</a>, <a target="_blank" rel="noopener noreferrer" href="https://rustwasm.github.io/wasm-pack/installer/">wasm-pack</a>, <a target="_blank" rel="noopener noreferrer" href="https://rustwasm.github.io/book/game-of-life/setup.html#cargo-generate">cargo-generate</a>, and make sure <a target="_blank" rel="noopener noreferrer" href="https://www.npmjs.com/get-npm">npm</a> is installed and up to date.</p><p>With a few substantial differences, I’m roughly following the directory structure shown <a target="_blank" rel="noopener noreferrer" href="https://rustwasm.github.io/book/game-of-life/hello-world.html">here</a>, but I’ll go through the process step by step. I also have the code up on my Github, <a target="_blank" rel="noopener noreferrer" href="https://github.com/prichey/hello-wasm">here</a>.</p><p>Our project will have 2 main directories inside of the root, <code class="language-text">lib</code>, which will house our Rust code, and <code class="language-text">app</code>, which will house our React app. For local development, we’ll use <code class="language-text">npm link</code> to get around needing to deploy our Wasm code as a module, so these two directories really don’t need to be next to each other; I’m just doing so for convenience.</p></section><section class="blog-section"><h2 id="creating-our-rust-module" style="position:relative"><a href="#creating-our-rust-module" aria-label="creating our rust module permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating our Rust module</h2><p>First, make a directory and move into it.</p><div class="gatsby-highlight" data-language="txt"><pre class="language-txt"><code class="language-txt">mkdir hello-wasm &amp;&amp; cd hello-wasm</code></pre></div><p>Next, let’s add our Rust code. I’m putting it in <code class="language-text">hello-wasm/lib</code>.</p><div class="gatsby-highlight" data-language="txt"><pre class="language-txt"><code class="language-txt">mkdir lib &amp;&amp; cd lib</code></pre></div><p>Let’s add our <code class="language-text">Cargo.toml</code>, which will act as a manifest for our Rust library. (More info <a target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/cargo/reference/manifest.html">here</a>.)</p><div class="gatsby-highlight" data-language="txt"><pre class="language-txt"><code class="language-txt">[package]
name = &quot;hello-wasm&quot;
version = &quot;0.1.0&quot;
authors = [&quot;Your Name &lt;you@email.com&gt;&quot;]

[lib]
crate-type = [&quot;cdylib&quot;, &quot;rlib&quot;]

[dependencies]
wasm-bindgen = &quot;=0.2.34&quot;</code></pre></div><p>Note: we need this specific <code class="language-text">wasm-bindgen</code> version because of <a target="_blank" rel="noopener noreferrer" href="https://github.com/rustwasm/book/issues/148#issuecomment-463809784">reasons</a>.</p><p>I’m omitting some niceties included in the Rust book setup doc, like allocation optimizations and an improved error handling. (<a target="_blank" rel="noopener noreferrer" href="https://github.com/rustwasm/wasm-pack-template/blob/master/Cargo.toml">More here.</a>) You should probably include those if you plan on going further than this tutorial, but for the sake of simplicity I’ll leave that as an exercise for the reader. (That’s you!)</p><p>Next, we’ll add our library code which will be compiled to Wasm.</p><div class="gatsby-highlight" data-language="txt"><pre class="language-txt"><code class="language-txt">mkdir src &amp;&amp; touch src/lib.rs</code></pre></div><p>Make <code class="language-text">lib.rs</code> look like this:</p><div class="gatsby-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">wasm_bindgen</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">wasm_bindgen<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[wasm_bindgen]</span>
<span class="token keyword">extern</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">alert</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[wasm_bindgen]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;👋 from Wasm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div><p>Briefly, what’s going on here is that we’re importing an external package <code class="language-text">wasm_bindgen</code> which generates the bindings and glue for our public function <code class="language-text">greet</code> so that it gets exported and can be called by JavaScript. Our <code class="language-text">greet</code> function calls some externally defined function <code class="language-text">alert</code>, which in this case is JavaScript’s <code class="language-text">window.alert()</code>. For more information on <code class="language-text">wasm_bindgen</code>, check out the <a target="_blank" rel="noopener noreferrer" href="https://rustwasm.github.io/wasm-bindgen/">docs</a>.</p></section><section class="blog-section"><h2 id="building-and-linking" style="position:relative"><a href="#building-and-linking" aria-label="building and linking permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building and linking</h2><p>Now, we’ll compile our Rust code and generate the module that will communicate with JS.</p><p>From <code class="language-text">lib</code>, run the following:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">wasm-pack build</code></pre></div><p>If everything goes as expected, you should have a new directory, <code class="language-text">pkg</code>, that contains a <code class="language-text">package.json</code> as well as the module that will eventually be imported by JS. For more information about the files that are generated, check out the Rust / Wasm setup guide <a target="_blank" rel="noopener noreferrer" href="https://rustwasm.github.io/book/game-of-life/hello-world.html#build-the-project">here</a>.</p><p>For a production app, <code class="language-text">pkg</code> should be published on <code class="language-text">npm</code> (via <a target="_blank" rel="noopener noreferrer" href="https://docs.npmjs.com/cli/publish">npm-publish</a>), but for now, we’ll do some linking to get things to work locally. (Note: if you do actually go to publish your package, you’ll need a unique name. <code class="language-text">hello-wasm</code> is already taken.)</p><p>From inside the <code class="language-text">pkg</code> directory, run</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">link</span></code></pre></div><p>This tells <code class="language-text">npm</code> that any time you try to import <code class="language-text">module-name</code> (in our case <code class="language-text">hello-wasm</code>), use symlinks to include the library which normally would be hosted externally.</p></section><section class="blog-section"><h2 id="creating-the-client" style="position:relative"><a href="#creating-the-client" aria-label="creating the client permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating the client</h2><p>Now that our Rust module is all built and linked, it is ready to be used by our web app. I’m partial to React, (and to the convenience of <a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/create-react-app">create-react-app</a>) so that’s what we’ll use.</p><p>Back in the root of the project, run the following:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">npx create-react-app app</code></pre></div><p>By default, our React application’s webpack configuration doesn’t know how to parse <code class="language-text">wasm</code> files. I wanted to find a way to fix this without <a target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#npm-run-eject">ejecting</a> and luckily, I did, using <a target="_blank" rel="noopener noreferrer" href="https://github.com/timarney/react-app-rewired">react-app-rewired</a>.</p><p>Add the following dev dependencies (from inside our <code class="language-text">app</code> directory):</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> react-app-rewired wasm-loader -D</code></pre></div><p>Then, add a file in the root of our app, <code class="language-text">config-overrides.js</code>, which is the entry point for <code class="language-text">react-app-rewired</code>. Make it look like the following:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">override</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wasmExtensionRegExp <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.wasm$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>

  config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#x27;.wasm&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">rule</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>rule<span class="token punctuation">.</span>oneOf <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">oneOf</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oneOf<span class="token punctuation">.</span>loader <span class="token operator">&amp;&amp;</span> oneOf<span class="token punctuation">.</span>loader<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#x27;file-loader&#x27;</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Make file-loader ignore WASM files</span>
        oneOf<span class="token punctuation">.</span>exclude<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>wasmExtensionRegExp<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Add a dedicated loader for WASM</span>
  config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> wasmExtensionRegExp<span class="token punctuation">,</span>
    <span class="token literal-property property">include</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#x27;src&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">loader</span><span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;wasm-loader&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>This particular configuration I found via this <a target="_blank" rel="noopener noreferrer" href="https://github.com/ballercat/wasm-loader/issues/3#issuecomment-459944069">issue</a> on Github issue. For more information on what all can be overridden, check out the <a target="_blank" rel="noopener noreferrer" href="https://github.com/timarney/react-app-rewired#extended-configuration-options">docs</a>.</p><p>In order for our overrides file to be loaded, we also need to update our <code class="language-text">package.json</code> to call our <code class="language-text">start</code> and <code class="language-text">build</code> scripts via <code class="language-text">react-app-rewired</code>, like so:</p><div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired start&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired build&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired test&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div></section><section class="blog-section"><h2 id="putting-it-all-together" style="position:relative"><a href="#putting-it-all-together" aria-label="putting it all together permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Putting it all together</h2><p>In order to get around deploying our Wasm module to npm, we need to use the symlink we set up above. From inside our <code class="language-text">app</code> directory, run the following:</p><div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">link</span> hello-wasm</code></pre></div><p>Now, all’s that’s left is to use the module in our React app. Feel free to start the app (<code class="language-text">npm run start</code>), and go to <a target="_blank" rel="noopener noreferrer" href="http://localhost:3000">localhost:3000</a> to see it running in your browser.</p><p>Next, replace <code class="language-text">App.js</code> with the following:</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#x27;./App.css&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Loaded</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> wasm <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>wasm<span class="token punctuation">.</span>greet<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Click me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Unloaded</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> loading<span class="token punctuation">,</span> loadWasm <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> loading <span class="token operator">?</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>loadWasm<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Load library</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>loading<span class="token punctuation">,</span> setLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>wasm<span class="token punctuation">,</span> setWasm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">loadWasm</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> wasm <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#x27;hello-wasm&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setWasm</span><span class="token punctuation">(</span>wasm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>App<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>App-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>wasm <span class="token operator">?</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Loaded</span></span> <span class="token attr-name">wasm</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>wasm<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Unloaded</span></span> <span class="token attr-name">loading</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>loading<span class="token punctuation">}</span></span> <span class="token attr-name">loadWasm</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>loadWasm<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre></div><p>Note: I’m using <a target="_blank" rel="noopener noreferrer" href="https://reactjs.org/docs/hooks-intro.html">Hooks</a> here, which depend on React 16.8 or higher. If you just created your app, you shouldnt’ have any issues, but if you’re using a legacy app you’ll either need to do some refactoring or update React.</p><p>You should see a button on screen, ‘Load library.’ Click on that then click again to call the loaded library. If everything went as expected, you should see an alert pop up with a greeting. Congrats, you have successfully imported and run Wasm code!</p><p>You can also try out a (hopefully) working version of the app <a target="_blank" rel="noopener noreferrer" href="https://hello-wasm.netlify.com/">here</a>.</p></section><section class="blog-section"><h2 id="going-deeper" style="position:relative"><a href="#going-deeper" aria-label="going deeper permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Going deeper</h2><p>Conceptually, there are a few things going on here. I’ll go into detail about a few points that are worth discussing.</p><p>First, inside our <code class="language-text">App</code> component, we have a function <code class="language-text">loadWasm</code>:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">loadWasm</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> wasm <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#x27;hello-wasm&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setWasm</span><span class="token punctuation">(</span>wasm<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>Notably, this function is asynchronous. You might have expected to import our Wasm module at the top of the file, like you would most other modules (<code class="language-text">import {wasm} from &#x27;hello-wasm&#x27;</code>, e.g.). We do this for a few reasons. First, the browser gives the following error when attempting to import the wasm module synchronously:</p><div class="gatsby-highlight" data-language="error"><pre class="language-error"><code class="language-error">WebAssembly module is included in initial chunk.
This is not allowed, because WebAssembly download and compilation must happen asynchronous.</code></pre></div><p>Furthermore, allowing the user to opt in to loading the full Wasm code is the best practice especially if your Wasm module is huge. Giving a user a heads up before loading such a large chunk (especially those on slower or mobile connections) is probably the best approach in this situation.</p><p>Our App renders the following JSX:</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>App<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>App-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>wasm <span class="token operator">?</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Loaded</span></span> <span class="token attr-name">wasm</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>wasm<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Unloaded</span></span> <span class="token attr-name">loading</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>loading<span class="token punctuation">}</span></span> <span class="token attr-name">loadWasm</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>loadWasm<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre></div><p>If our <code class="language-text">wasm</code> library hasn’t been loaded, we render the <code class="language-text">Unloaded</code> component, passing through props <code class="language-text">loading</code> (whether or not the App is currently loading the Wasm module) and <code class="language-text">loadWasm</code> (the function which, once called, will import the Wasm code itself).</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Unloaded</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> loading<span class="token punctuation">,</span> loadWasm <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> loading <span class="token operator">?</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>loadWasm<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Load library</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>Once <code class="language-text">loadWasm</code> is called on button click, a loading message is shown, and then our <code class="language-text">Loaded</code> component is rendered once the module successfully loads.</p><div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Loaded</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> wasm <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>wasm<span class="token punctuation">.</span>greet<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Click me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></code></pre></div><p>The Loaded component is where you would place any code that relies on your Wasm library. Here, we just render a button. On click, we call the one function exported by our Rust module, <code class="language-text">greet</code>, which calls JavaScript’s <code class="language-text">alert</code>. If you haven’t already, go ahead and click on the button to confirm it works as expected.</p><div class="blog-inset"><figure><img tabindex="0" src="/static/load-88ef6ca88514cd4b4e38d79226ab409b.jpg" style="cursor:zoom-in"/></figure></div><p>Two clicks later…</p><div class="blog-inset"><figure><img tabindex="0" src="/static/alert-7408fa4ea3af2aae2989ae582f5f9e95.jpg" alt="Tada!" style="cursor:zoom-in"/><figcaption class="ZoomImage__StyledFigcaption-sc-1h80lva-0 dgaDPU">Tada!</figcaption></figure></div><p>(I added a bit of a bit of CSS for the sake of those screenshots.)</p></section><section class="blog-section"><h2 id="whats-next" style="position:relative"><a href="#whats-next" aria-label="whats next permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What’s next?</h2><p>Hopefully everything included above works for you, or at least helps you getting to a working solution. And hopefully you’re as excited as I am about the potential of WebAssembly! I plan on delving deeper into Wasm and using it for a more substantial application. Popping up an alert is cool and all, but it doesn’t scratch the surface of what Wasm is really capable of. I plan on continuing to blog whenever I have anything interesting to say, so feel free to follow along either <a target="_blank" rel="noopener noreferrer" href="https://prestonrichey.com/blog/">here</a> or on <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/prestonrichey">Twitter</a>. Thanks for reading!</p><p>A caveat: WebAssembly is still in active development (as are most of the different tools used in the process of generating Wasm). I had to do lots of searching to find a solution that worked at the time of publishing. It’s very possible that in the future these specific fixes won’t work, and though I’ll try to keep this post updated, there’s no way I can guarantee this will work in perpetuity. Just a heads up!</p></section><time class="post__StyledPostDate-sd6zd6-0 fxovqS">2019-02-25</time></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-70108869-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/react-rust-wasm/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2836f668b53c194d95e2.js"],"app":["/app-51712915004c1ee7906c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-6e2ed661a9da000061a6.js"],"component---src-pages-about-2-mdx":["/component---src-pages-about-2-mdx-855c945d8fe33b0c2e14.js"],"component---src-pages-about-js":["/component---src-pages-about-js-26ceb8e6a2db85740bb5.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-f25047d2b0cd9928e43c.js"],"component---src-pages-education-mdx":["/component---src-pages-education-mdx-0972be65eb9010458285.js"],"component---src-pages-experience-mdx":["/component---src-pages-experience-mdx-92ed9f0e2a145b10a820.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a3818d46c5ff259181a1.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-68124deec253111ab3a2.js"],"component---src-templates-post-js":["/component---src-templates-post-js-3a720babd166f93a18ee.js"],"component---src-templates-project-js":["/component---src-templates-project-js-bfce31c29584dc7f983d.js"]};/*]]>*/</script><script src="/polyfill-2836f668b53c194d95e2.js" nomodule=""></script><script src="/component---src-templates-post-js-3a720babd166f93a18ee.js" async=""></script><script src="/b4c8b9bfe57989d347dcb0518f327ec77d315bf1-81e54c09b1119b78609f.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-51712915004c1ee7906c.js" async=""></script><script src="/framework-eb684e3e828ad13b3940.js" async=""></script><script src="/webpack-runtime-f494e936f949e325e958.js" async=""></script></body></html>